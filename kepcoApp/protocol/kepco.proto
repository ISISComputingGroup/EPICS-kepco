Terminator = '\r\n';
ReplyTimeout = 2000;

getIDN {
    out "*IDN?";
    #Read no more that 39 chars (EPICS limit)
    in "%/(.{0,39})/";
    ExtraInput = Ignore;
}

RST
{
    out "*RST";
}

setRemote
{
    #Needs to be done first
    out "SYST:REM %{0|1}";
}

readActualCurrent {
    out "MEAS:CURR?";
    in "%f";
    ExtraInput = Ignore;
}

readSetpointCurrent {
    out "CURR?";
    in "%f";
    ExtraInput = Ignore;
}

writeCurrent 
{
    out "SYST:REM 1";
    out "CURR %f";
    
    # immediately update SP:RBV
    out "CURR?";
    in "%(\$1CURRENT:SP:RBV)f";
    ExtraInput = Ignore;
}

readActualVoltage {
    out "MEAS:VOLT?";
    in "%f";
    ExtraInput = Ignore;
}

readSetpointVoltage {
    out "VOLT?";
    in "%f";
    ExtraInput = Ignore;
}

writeVoltage
{
    out "SYST:REM 1";
    out "VOLT %f";
    
    # immediately update SP:RBV
    out "VOLT?";
    in "%(\$1VOLTAGE:SP:RBV)f";
    ExtraInput = Ignore;
}

readOutputMode
{
    out "FUNC:MODE?";
    in "%d";
    ExtraInput = Ignore;
}

setOutputMode
{
    out "SYST:REM 1";
    out "FUNC:MODE %{VOLT|CURR}";
    
    # Immediately update readback
    out "FUNC:MODE?";
    in "%(\$1OUTPUTMODE)d";
    ExtraInput = Ignore;
}

readOutputStatus
{
    out "OUTP?";
    in "%d";
    ExtraInput = Ignore;
}

setOutputStatus
{
    out "SYST:REM 1";
    out "OUTP %{0|1}";
    
    # Immediately update readback
    out "OUTP?";
    in "%(\$1OUTPUTSTATUS)d";
    ExtraInput = Ignore;
}
